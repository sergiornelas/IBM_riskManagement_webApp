{% extends 'base.html' %}

{% block content %}

<script>
    console.log(localStorage.arrayPatchesPatches)
    $(document).ready(function () {
        $("#content").val(localStorage.arrayPatchesPatches);
        $("#exception_type_IDD").val("1");
    });
</script>

<section id="showcase-inner" class="py-5 text-white">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-12">
                <h1 class="display-4">INQUIRY PATCHES</h1>
                <i class="fa fa-clipboard fa-5x" aria-hidden="true"></i>
                <p class="lead">Manage your patches if you have struggles</p>
            </div>
        </div>
    </div>
</section>

<!-- Breadcrumb -->
<section id="bc" class="mt-3">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url 'dashboard' %}">
                        <i class="fas fa-home"></i> Dashboard </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{% url 'exceptionsBoard' %}">
                        <i class="fas fa-calendar-check"></i> Requests </a>
                </li>
            </ol>
        </nav>
    </div>
</section>

<script>
    /*
   var limitdays;
   $.ajax({
      async: false,
      method: "POST",
      data: {
         //limitDay: localStorage.arrayServerPatches
         limitDay: localStorage.arrayPatchesPatches
      },
      url: 'getDaysLimit',

   }).done(function (data) { //ME DEVUELVE LOS OBJETOS ADVIOSORY RELACIONADOS AL SERVER SELECCIONADO
      //console.log(data)
      limitdays = data
   });
   */
</script>

<div class="container">
    <!--  PROGRESS BAR -->
    <div class="container">
        <div class="steps">
        <ul class="steps-container">
            <li style="width:25%;" class="activated">
                <div class="step">
                    <div class="step-image"><span></span></div>
                    <div class="step-current">Type of exception</div>
                    <div class="step-description">Server or patch</div>
                </div>
            </li>
            <li style="width:25%;"class="activated">
                <div class="step">
                    <div class="step-image"><span></span></div>
                    <div class="step-current">Choose server</div>
                    <div class="step-description">Select server</div>
                </div>
            </li>
            <li style="width:25%;"class="activated">
                <div class="step">
                    <div class="step-image"><span></span></div>
                    <div class="step-current">Choose patch</div>
                    <div class="step-description">Select patches</div>
                </div>
            </li>
            <li style="width:25%;"class="activated">
                <div class="step">
                    <div class="step-image"><span></span></div>
                    <div class="step-current">Inquiry</div>
                    <div class="step-description">Form</div>
                </div>
            </li>
        </ul>
        <div class="step-bar" style="width: 100%;"></div>
        </div>
    </div>

    <div class="container">
        <div class="row"></div>
        <div style="margin-bottom: 2em;"></div>
        <p>List of servers selected:</p>
        <div id="demo"
            style="background-color: lightgrey; padding: 1em; border: 1px solid grey; margin-bottom: 2em; font-style: italic;">
        </div>
        <script>
            document.getElementById("demo").innerHTML = localStorage.arrayPatchesPatches;
        </script>
    </div>

    <form action="{% url 'exclude_server' %}" method="POST">

        {% csrf_token %}

        <input id="content" type="hidden" name="content">

        <input id="exception_type_IDD" type="hidden" name="exception_type">

        <!-- Estos se introducen del modelo de exception -->
        <div class="form-group">
            <label for="title" class="col-form-label"><b>Title:</b><i> (set the title that approvers can use as
                    reference)</i></label>
            <input style="border: 1px solid grey;" type="text" name="title" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="justification" class="col-form-label"><b>Action plan:</b><i> (define steps you will execute for
                    implement the updates)</i></label>
            <textarea style="border: 1px solid grey;" rows="7" name="justification" class="form-control"
                required></textarea>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-md-4"></div>
                <label for="excludeDate" class="col-form-label col-md-4""><b>Exclude date:</b> <i>(this is defined by major patch criticality)</i></label>
            <div class=" col-md-4">
            </div>
        </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-4"></div>
        <input type="datetime" readonly="readonly" name="exclude_date" class="tail-datetime-field form-control col-md-4"
            autocomplete="off" required>
        <div class="col-md-4"></div>
    </div>
</div>

<!--     CALENDAR      -->

<script type="text/javascript">
    /*
    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
    var yyyy = today.getFullYear();
 
    today = yyyy + '-' + mm + '-' + dd;
    
    var limit = new Date();
    var dd = String(limit.getDate() - 30 *86400000).padStart(2, '0');
    var mm = String(limit.getMonth() + 1).padStart(2, '0'); //January is 0!
    var yyyy = limit.getFullYear();
 
    limit = yyyy + '-' + mm + '-' + dd;
    
    //limitdays
    console.log(today)
    console.log(limit)
    */

    Date.prototype.addDays = function (days) {
        var date = new Date(this.valueOf());
        date.setDate(date.getDate() + days);
        return date;
    }

    var data = new Date();

    //console.log(limitdays)

    document.addEventListener("DOMContentLoaded", function () {

        tail.DateTime(".tail-datetime-field", {
            dateRanges: [
                {
                    //start: new Date(2020, 5, 5),
                    //start: today,
                    start: data,
                    //end: new Date(2020, 6, 30),
                    //end: data.addDays(50)
                    //end: data.addDays(parseInt(limitdays))
                    end: data.addDays(60)
                    // days: true                 // This is the default
                }],
            dateStart: new Date(2018, 0, 5),
            dateBlacklist: false,
            viewDecades: false,
            //animate: false,
            startOpen: true,
            stayOpen: true,
            closeButton: false,
        }
        );
    });

</script>

<!-- FALTA AGREGAR EL ACTION PLAN -->
<hr style="margin-bottom: 23em;">

<div class="container">
    <div class="row">
        <div class="col-md-3"> </div>
        <div style="padding-top: 2em;" class="col-md-3">
            <a style="background-color:#D0D0D5" href="{% url 'selectPatches' %}" class="btn btn-block">Back</a>
        </div>
        <div style="padding-top: 2em;" class="col-md-3">
            <input style="margin-bottom: 1rem;" type="submit" value="Send" class="btn btn-block btn-secondary" />
        </div>

    </div>
</div>

<!-- name = database field, value = input value to db -->
</form>
</div>

{% endblock %}